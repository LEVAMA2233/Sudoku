#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include<string.h>

#define P printf
#define S scanf

struct juego {
    int tablero[9][9];
    char nombre;//nombre del jugador
    int numHistorial;
};

typedef struct juego JUEGO;

int menu(int x); void establecer_tablero(JUEGO *juego, int tablero_inicial[9][9]);
void imprimir_tablero(const JUEGO *juego); bool verificaCasilla_ingresada(const JUEGO *juego, int fil, int col, int num);
void ingresaNum(JUEGO *juego);void guardarPartida(JUEGO *, int *, const JUEGO *);

int main() {
    JUEGO j;
    int opcion,numJugadores,i=0;
    int tablero_inicial[9][9] = {
        {5, 0, 0, 0, 7, 0, 0, 0, 0},
        {6, 0, 0, 1, 9, 5, 0, 0, 0},
        {0, 9, 8, 0, 0, 0, 0, 6, 0},
        {8, 0, 0, 0, 6, 0, 0, 0, 3},
        {4, 0, 0, 8, 0, 3, 0, 0, 1},
        {7, 0, 0, 0, 2, 0, 0, 0, 6},
        {0, 6, 0, 0, 0, 0, 2, 8, 0},
        {0, 0, 0, 4, 1, 9, 0, 0, 5},
        {0, 0, 0, 0, 8, 0, 0, 7, 9}
    };
    P("¿Cuantos jugadores son?: ");S("%d",&numJugadores);
    JUEGO *partidas=(JUEGO *)malloc(numJugadores*sizeof(JUEGO));
    if(partidas==NULL){
    	P("Surgio un error en la asignacion de memoria.");
    	return 1;
	}
	establecer_tablero(&j,tablero_inicial);
	imprimir_tablero(&j);
	opcion=menu(i);
	
	while(opcion!=5){
		switch(opcion){
			case 1:
				ingresaNum(&j);
				break;
			case 2:
				P("\nSeleccionaste imprimir tablero\n");
				P("//////////////////////////////////\n");
				imprimir_tablero(&j);
				break;
			case 3:
				guardarPartida(partidas,&i,&j);
				system("cls");
				P("El juego se ha reiniciado para el nuevo jugador.\n");
				establecer_tablero(&j,tablero_inicial);
				break;
			case 5:
				return 0;
		}
		opcion=menu(i);
	}

    return 0;
}

int menu(int x){
	int opc;
	P("Bienvenido al Sudoku! \n");
    P("\nPresione el numero indicado en las opciones del menu, presione 4 para guardar y salir.\n");
	P("\nMENU DE JUEGO:\n 1-$ Ingresa valor al tablero.\n2-$ Imprimir estado actual del juego\n3-$ Guardar partida\n"
	"4-$ Cambiar jugador (Guardado automatico)\n");
	P("$:");S("%d",&opc);
	return opc;
}

void establecer_tablero(JUEGO *juego, int tablero_inicial[9][9]) {
    // Establecer el tablero inicial con los valores proporcionados
    for (int i = 0; i < 9; i++) {
        for (int j = 0; j < 9; j++) {
            juego->tablero[i][j] = tablero_inicial[i][j];
        }
    }
}

void imprimir_tablero(const JUEGO *juego) {
    P("Tablero:\n");
    for (int i = 0; i < 9; i++) {
        for (int j = 0; j < 9; j++) {
            P("%d ", juego->tablero[i][j]);
        }
        P("\n");
    }
}

bool verificaCasilla_ingresada(const JUEGO *juego, int fil, int col, int num) {
    // Verificar la fila y la columna
    for (int i = 0; i < 9; i++) {
        if (juego->tablero[fil][i] == num || juego->tablero[i][col] == num) {
            return false; // Número repetido encontrado en la fila o columna
        }
    }
    // Verificar el cuadrante 3x3
    int inicioFila = fil - fil % 3;
    int inicioCol = col - col % 3;
    for (int i = inicioFila; i < inicioFila + 3; i++) {
        for (int j = inicioCol; j < inicioCol + 3; j++) {
            if (juego->tablero[i][j] == num) {
                return false; // Número repetido encontrado en el cuadrante 3x3
            }
        }
    }

    return true; 
}

void ingresaNum(JUEGO *juego) {
    int fila, columna, valor;

        P("\nIngrese la fila (1-9):");
        S("%d", &fila);
        P("Ingresa la columna (1-9):");
        S("%d",&columna);
        P("Ingrese el numero para la casilla (%d,%d)",fila,columna);
        S("%d",&valor);
        if (fila < 1 || fila > 9 || columna < 1 || columna > 9 || valor < 1 || valor > 9) {
            P("Entrada no válida. Por favor, ingrese valores válidos.\n");
            
        }

        if (juego->tablero[fila - 1][columna - 1] == 0 && verificaCasilla_ingresada(juego, fila - 1, columna - 1, valor)) {
            juego->tablero[fila - 1][columna - 1] = valor;
            P("Numero agregado exitosamente.\n");
            P("--------------------------------\n");
        } else {
            P("Número no válido o casilla ocupada. Por favor, ingrese otro valor.\n");
        }
}

void guardarPartida(JUEGO *partidas, int *partidasGuardadas, const JUEGO *juego) {
    partidas[*partidasGuardadas] = *juego; // Guardar el estado actual del juego en el arreglo de partidas
    (*partidasGuardadas)++; // Incrementar el contador de partidas guardadas, cambiamos el valor de i que esta en el main
    P("Partida guardada exitosamente.\n");
}

